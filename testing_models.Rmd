---
title: "Testing the models"
author: "Pooya Razavi"
date: "last knitted: `r Sys.time()`"
output: 
  html_document:
    theme: cosmo
    highlight: textmate
    toc: TRUE
    toc_float: TRUE
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(tidyverse)
library(lmerTest)
library(sjPlot)
library(sjmisc)
library(emmeans)
library(MetBrewer)


df <- read.csv("Perc_AngExpress_longish_scored.csv")


#a dataframe with only the relevant variables, and predictors as factors
df2 <- df %>% 
            select(duration, response_id, scenario, harm_target, prot_gender, anger_express, 
                   communalism, steadfastness, wisdom, obstinacy) %>% 
            mutate_if(sapply(., is.character), as.factor)          

levels(df2$harm_target) <- c("Other", "Self")
levels(df2$prot_gender) <- c("Female", "Male")
levels(df2$anger_express) <- c("No", "Yes")

knitr::opts_chunk$set(echo = TRUE, emm_options(pbkrtest.limit = 4000))
```

# Outcome: Communalism

## Descriptives

```{r communal-descript}
#descriptives
    #main effects
    psych::describeBy(df2$communalism, group = df2$anger_express, mat = TRUE) %>% knitr::kable(digits = 2)
    psych::describeBy(df2$communalism, group = df2$harm_target, mat = TRUE) %>% knitr::kable(digits = 2)
    psych::describeBy(df2$communalism, group = df2$prot_gender, mat = TRUE) %>% knitr::kable(digits = 2)
    
    #interactions
    psych::describeBy(df2$communalism, 
                      group = list(df2$anger_express, df2$harm_target), mat = TRUE) %>% 
      knitr::kable(digits = 2)
    
    psych::describeBy(df2$communalism, 
                      group = list(df2$anger_express, df2$prot_gender), mat = TRUE) %>% 
      knitr::kable(digits = 2)
    
    psych::describeBy(df2$communalism, 
                      group = list(df2$anger_express, df2$harm_target, df2$prot_gender), mat = TRUE) %>% 
      knitr::kable(digits = 2)
    
```

## The models

### Omnibus

```{r communal-model0}
#setting the contrasts
    contrasts(df2$harm_target) <- contr.sum
    contrasts(df2$prot_gender) <- contr.sum
    contrasts(df2$anger_express) <- contr.sum

#omnibus model
    communalism_m1 <- lmer(communalism ~ harm_target * prot_gender * anger_express + (1 | response_id),
                                 data = df2)
    anova(communalism_m1)
    #summary(communalism_m1) 
    #pander::pander( anova( communalism_m1 ) ) 
```


### First research question

```{r communal-model1}
    emmeans(communalism_m1, pairwise ~ anger_express | )

#additional
    emmeans(communalism_m1, pairwise ~ harm_target | anger_express)
```    

### Second research question

```{r communal-model2}
    emmeans(communalism_m1, pairwise ~ prot_gender | anger_express)    
```


### Third research question

```{r communal-models3}
#interaction
  communalism_rq3_model <- df2 %>% 
                            dplyr::filter(anger_express == "Yes") %>% 
                                lmer(communalism ~ harm_target * prot_gender + (1 | response_id),
                                                           data = .)
  anova(communalism_rq3_model, type = "III") %>% knitr::kable(format = "pipe")
#simple interaction effects
  emmeans(communalism_rq3_model, pairwise ~  prot_gender | harm_target)

```

## Figures 

For this first outcome, I'll try three different packages for visualization. Only the best one will be used for the remaining outcomes.

### Using emmeans

```{r communal-visuals-emmeans, fig.align='center', fig.width=5}

    #first research question
    emmip(communalism_m1, anger_express ~ harm_target) 

    #second research question
    emmip(communalism_m1, prot_gender ~ anger_express)    


    #third research question
    emmip(communalism_m1, anger_express ~ harm_target * prot_gender) 
    
    emmip(communalism_rq3_model, ~ prot_gender * harm_target) 
```    
    
### Using sjPlot

```{r communal-visuals-sjPlot, fig.align='center', fig.width=5}

    #first research question
    sc_rq1_p <- plot_model(communalism_m1, type = "pred", terms = c("harm_target", "anger_express"),
                    title = "Outcome: Communalism",
                     axis.title = c("Target of Harm", "Rating of Communalism"),
                    legend.title = "Anger Expressed",
                    axis.lim = c(1,5)) +
                    theme_bw()
    sc_rq1_p
    
    #second research question
    sc_rq2_p <- plot_model(communalism_m1, type = "pred", terms = c("prot_gender", "anger_express"),
                    title = "Outcome: Communalism",
                     axis.title = c("Protagonist's Gender", "Rating of Communalism"),
                    legend.title = "Anger Expressed",
                    axis.lim = c(1,5)) +
                    theme_bw()
    sc_rq2_p
    
    #third research question
    plot_model(communalism_rq3_model, type = "pred", terms = c("harm_target", "prot_gender"),
                    title = "Outcome: Communalism",
                     axis.title = c("Target of Harm", "Rating of Communalism"),
                    legend.title = "Protagonist's Gender",
                    axis.lim = c(1,5)) +
                    theme_bw()
```
        
### Using ggplot

```{r communal-visuals-ggplot, fig.align='center', fig.width=5}
#research question 1  
    
    #getting mean and se for the graph
    descripts <- psych::describeBy(df2$communalism, 
                                   group = list(df2$anger_express, df2$harm_target), mat = TRUE) %>% 
                  select(group1, group2, mean, se) %>% 
                  transmute(Expression = group1,
                            Target = group2,
                            mean, se)
    
    
     #interaction plot - dot-whiskers and line plot
  com_rq1 <-  ggplot(
                descripts,
                aes(x = Expression, color = Target, group = Target, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Target), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Communalism") +
                labs(y="Rating of Protagonist's Communalism", x = "Anger Expressed", color = "Target of Harm") +
                theme(plot.title = element_text(hjust = 0.5))+ 
                scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))
      com_rq1
      
      #ggsave(plot = com_rq1, width = 5, height = 5, dpi = 600, filename = "communalism_rq1.png")
      

       #interaction plot - bar plot
              ggplot(
                descripts,
                aes(x = Target, fill = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) +
                geom_col(position = position_dodge(width=0.7), width = .6) +
                geom_errorbar(position = position_dodge(width=0.7), width = 0.15) +
                #facet_wrap(~Target) +
                scale_y_continuous(limits = c(1, 5), oob = scales::squish) +
                theme_bw() + 
                ggtitle("Communalism") +
                labs(y="Rating of Protagonist's Communalism", x = "Target of Harm", fill = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                scale_fill_manual(values=met.brewer("Nizami", 2, direction=-1))
              
              
#research question 2  
    
    #getting mean and se for the graph
    descripts <- psych::describeBy(df2$communalism, 
                                   group = list(df2$anger_express, df2$prot_gender), mat = TRUE) %>% 
                  select(group1, group2, mean, se) %>% 
                  transmute(Expression = group1,
                            Gender = group2,
                            mean, se)
    
    
     #interaction plot - dot-whiskers and line plot
           
        com_rq2 <-  ggplot(
                     descripts,
                      aes(x = Gender, color = Expression, group = Expression, y = mean,
                          ymin = mean-se, ymax = mean+se)) + 
                      geom_line(position = position_dodge(0.1)) +
                      geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                      geom_point(aes(color = Expression), position = position_dodge(0.1), size = .8) +
                      ylim(1, 5) +
                      theme_bw() + 
                      ggtitle("Communalism") +
                      labs(y="Rating of Protagonist's Communalism", x = "Protagonist's Gender", color = "Anger Expressed") +
                      theme(plot.title = element_text(hjust = 0.5))+ 
                      scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))
            com_rq2
          #ggsave(plot = com_rq2, width = 5, height = 5, dpi = 600, filename = "communalism_rq2.png")
            
        #interaction plot - bar plot
              ggplot(
                descripts,
                aes(x = Gender, fill = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) +
                geom_col(position = position_dodge(width=0.7), width = .6) +
                geom_errorbar(position = position_dodge(width=0.7), width = 0.15) +
                #facet_wrap(~Target) +
                scale_y_continuous(limits = c(1, 5), oob = scales::squish) +
                theme_bw() + 
                ggtitle("Communalism") +
                labs(y="Rating of Protagonist's Communalism", x = "Protagonist's Gender", fill = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                scale_fill_manual(values=met.brewer("Nizami", 2, direction=-1)) 
              
#research question 3
      descripts <- psych::describeBy(df2$communalism, 
                         group = list(df2$anger_express, df2$harm_target, df2$prot_gender), mat = TRUE)   %>% 
                        select(group1, group2, group3, mean, se) %>% 
                        transmute(Expression = group1,
                                  Target = group2,
                                  Gender = group3,
                                  mean, se) %>% 
                        filter(Expression == "Yes")

      
     #interaction plot - dot-whiskers and line plot
    com_rq3 <- ggplot(
                descripts,
                aes(x = Gender, color = Target, group = Target, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Target), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Communalism") +
                labs(y="Rating of Protagonist's Communalism", x = "Protagonist's Gender", color = "Target of Harm") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                      scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))      

    com_rq3
      #ggsave(plot = com_rq3, width = 5, height = 5, dpi = 600, filename = "communalism_rq3.png")
       
```

It seems that the ggplot figures are the most clear ones. For the remaining outcomes, I'll only use ggplot figures.

# Outcome: Steadfastness

## Descriptives

```{r steadfast-descript}
#descriptives
    #main effects
    psych::describeBy(df2$steadfastness, group = df2$anger_express, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    psych::describeBy(df2$steadfastness, group = df2$harm_target, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    psych::describeBy(df2$steadfastness, group = df2$prot_gender, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    
    #interactions
    psych::describeBy(df2$steadfastness, 
                      group = list(df2$anger_express, df2$harm_target), mat = TRUE) %>% 
      knitr::kable(digits = 2)
    
    psych::describeBy(df2$steadfastness, 
                      group = list(df2$anger_express, df2$prot_gender), mat = TRUE) %>% 
      knitr::kable(digits = 2)
    
    psych::describeBy(df2$steadfastness, 
                      group = list(df2$anger_express, df2$harm_target, df2$prot_gender), mat = TRUE) %>% 
      knitr::kable(digits = 2)
    
```

## The models

### Omnibus

```{r steadfast-model0}

#omnibus model
    steadfastness_m1 <- lmer(steadfastness ~ harm_target * prot_gender * anger_express + (1 | response_id),
                                 data = df2)
    anova(steadfastness_m1)
    #summary(steadfastness_m1)
    #pander::pander( anova( steadfastness_m1 ) ) 
```


### First research question

```{r steadfast-model1}
    emmeans(steadfastness_m1, pairwise ~ anger_express | harm_target)

#additional
    emmeans(steadfastness_m1, pairwise ~ harm_target | anger_express)

```    

### Second research question

```{r steadfast-model2}
    emmeans(steadfastness_m1, pairwise ~ prot_gender | anger_express)    
```


### Third research question

```{r steadfast-models3}
#interaction
  steadfast_rq3_model <- df2 %>% 
                            dplyr::filter(anger_express == "Yes") %>% 
                                lmer(steadfastness ~ harm_target * prot_gender + (1 | response_id),
                                                           data = .)
  anova(steadfast_rq3_model, type = "III") %>% knitr::kable(format = "pipe")
#simple interaction effects
  emmeans(steadfast_rq3_model, pairwise ~  prot_gender | harm_target)
  
  
```

## Figures 

### Research Question 1

```{r steadfast-visuals-rq1, fig.align='center', fig.width=5}
#research question 1  
    
    #getting mean and se for the graph
    descripts <- psych::describeBy(df2$steadfastness, 
                                   group = list(df2$anger_express, df2$harm_target), mat = TRUE) %>% 
                  select(group1, group2, mean, se) %>% 
                  transmute(Expression = group1,
                            Target = group2,
                            mean, se)
    
    
     #interaction plot - dot-whiskers and lines
          stead_rq1 <-  ggplot(
                            descripts,
                            aes(x = Expression, color = Target, group = Target, y = mean,
                                ymin = mean-se, ymax = mean+se)) + 
                            geom_line(position = position_dodge(0.1)) +
                            geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                            geom_point(aes(color = Target), position = position_dodge(0.1), size = .8) +
                            ylim(1, 5) +
                            theme_bw() + 
                            ggtitle("Steadfastness") +
                            labs(y="Rating of Protagonist's Steadfastness", x = "Anger Expressed", color = "Target of Harm") +
                            theme(plot.title = element_text(hjust = 0.5))+ 
                            scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))
          stead_rq1

          #ggsave(plot = stead_rq1, width = 5, height = 5, dpi = 600, filename = "steadfastness_rq1.png")
          
          
      #interaction plot - bar plot
              ggplot(
                descripts,
                aes(x = Target, fill = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) +
                geom_col(position = position_dodge(width=0.7), width = .6) +
                geom_errorbar(position = position_dodge(width=0.7), width = 0.15) +
                #facet_wrap(~Target) +
                scale_y_continuous(limits = c(1, 5), oob = scales::squish) +
                theme_bw() + 
                ggtitle("Steadfastness") +
                labs(y="Rating of Protagonist's Steadfastness", x = "Target of Harm", fill = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                scale_fill_manual(values=met.brewer("Nizami", 2, direction=-1))


```


### Research question 2  

```{r steadfast-visuals-rq2, fig.align='center', fig.width=5}
    #getting mean and se for the graph
    descripts <- psych::describeBy(df2$steadfastness, 
                                   group = list(df2$anger_express, df2$prot_gender), mat = TRUE) %>% 
                  select(group1, group2, mean, se) %>% 
                  transmute(Expression = group1,
                            Gender = group2,
                            mean, se)
    
    
     #interaction plot - dot-whiskers and lines
 
        stead_rq2 <-  ggplot(
                            descripts,
                            aes(x = Gender, color = Expression, group = Expression, y = mean,
                                ymin = mean-se, ymax = mean+se)) + 
                            geom_line(position = position_dodge(0.1)) +
                            geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                            geom_point(aes(color = Expression), position = position_dodge(0.1), size = .8) +
                            ylim(1, 5) +
                            theme_bw() + 
                            ggtitle("Steadfastness") +
                            labs(y="Rating of Protagonist's Steadfastness", x = "Protagonist's Gender", color = "Anger Expressed") +
                            theme(plot.title = element_text(hjust = 0.5))+ 
                            scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))
          stead_rq2

          #ggsave(plot = stead_rq2, width = 5, height = 5, dpi = 600, filename = "steadfastness_rq2.png")
          
      #interaction plot - bar plot
              ggplot(
                descripts,
                aes(x = Gender, fill = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) +
                geom_col(position = position_dodge(width=0.7), width = .6) +
                geom_errorbar(position = position_dodge(width=0.7), width = 0.15) +
                #facet_wrap(~Target) +
                scale_y_continuous(limits = c(1, 5), oob = scales::squish) +
                theme_bw() + 
                ggtitle("Steadfastness") +
                labs(y="Rating of Protagonist's Steadfastness", x = "Protagonist's Gender", fill = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                scale_fill_manual(values=met.brewer("Nizami", 2, direction=-1))    

```


### Research question 3

```{r steadfast-visuals-rq3, fig.align='center', fig.width=5}
    #getting mean and se for the graph
      descripts <- psych::describeBy(df2$steadfastness, 
                         group = list(df2$anger_express, df2$harm_target, df2$prot_gender), mat = TRUE)   %>% 
                        select(group1, group2, group3, mean, se) %>% 
                        transmute(Expression = group1,
                                  Target = group2,
                                  Gender = group3,
                                  mean, se) %>% 
                        filter(Expression == "Yes")

      
     #interaction plot - dot-whiskers and line plot
  stead_rq3 <- ggplot(
                descripts,
                aes(x = Gender, color = Target, group = Target, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Target), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Steadfastness") +
                labs(y="Rating of Protagonist's Communalism", x = "Protagonist's Gender", color = "Target of Harm") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                      scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))      

    stead_rq3
      #ggsave(plot = stead_rq3, width = 5, height = 5, dpi = 300, filename = "steadfastness_rq3.png")
    
    
```



# Outcome: Wisdom

## Descriptives

```{r wisd-descript}
#descriptives
    #main effects
    psych::describeBy(df2$wisdom, group = df2$anger_express, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    psych::describeBy(df2$wisdom, group = df2$harm_target, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    psych::describeBy(df2$wisdom, group = df2$prot_gender, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    
    #interactions
    psych::describeBy(df2$wisdom, 
                      group = list(df2$anger_express, df2$harm_target), mat = TRUE) %>% 
      knitr::kable(digits = 2, format = "pipe")
    
    psych::describeBy(df2$wisdom, 
                      group = list(df2$anger_express, df2$prot_gender), mat = TRUE) %>% 
      knitr::kable(digits = 2, format = "pipe")
    
    psych::describeBy(df2$wisdom, 
                      group = list(df2$anger_express, df2$harm_target, df2$prot_gender), mat = TRUE) %>% 
      knitr::kable(digits = 2, format = "pipe")
    
```

## The models

### Omnibus

```{r wisd-model0}
#omnibus model
    wisdom_m1 <- lmer(wisdom ~ harm_target * prot_gender * anger_express + (1 | response_id),
                                 data = df2)
    anova(wisdom_m1)
    #summary(wisdom_m1)
    #pander::pander( anova( wisdom_m1 ) ) 
```


### First research question

```{r wisd-model1}
    emmeans(wisdom_m1, pairwise ~ anger_express | harm_target)

#additional
    emmeans(wisdom_m1, pairwise ~ harm_target | anger_express)
```    

### Second research question

```{r wisd-model2}
    emmeans(wisdom_m1, pairwise ~ prot_gender | anger_express)    
```


### Third research question

```{r wisd-models3}

#interaction
  wisdom_rq3_model <- df2 %>% 
                            dplyr::filter(anger_express == "Yes") %>% 
                                lmer(wisdom ~ harm_target * prot_gender + (1 | response_id),
                                                           data = .)
  anova(wisdom_rq3_model, type = "III") %>% knitr::kable(format = "pipe")
#simple interaction effects
  emmeans(wisdom_rq3_model, pairwise ~  prot_gender | harm_target)
  
```

## Figures 

### Research Question 1

```{r wisd-visuals-rq1, fig.align='center', fig.width=5}
#research question 1  
    
    #getting mean and se for the graph
    descripts <- psych::describeBy(df2$wisdom, 
                                   group = list(df2$anger_express, df2$harm_target), mat = TRUE) %>% 
                  select(group1, group2, mean, se) %>% 
                  transmute(Expression = group1,
                            Target = group2,
                            mean, se)
    
    
     #interaction plot - dot-whiskers and lines
    wis_rq1 <-  ggplot(
                descripts,
                aes(x = Expression, color = Target, group = Target, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Target), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Wisdom") +
                labs(y="Rating of Protagonist's Wisdom", x = "Anger Expressed", color = "Target of Harm") +
                theme(plot.title = element_text(hjust = 0.5))+ 
                scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))
              
    wis_rq1
              
              #ggsave(plot = wis_rq1, width = 5, height = 5, dpi = 600, filename = "wisdom_rq1.png")
    
      #interaction plot - bar plot
              ggplot(
                descripts,
                aes(x = Target, fill = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) +
                geom_col(position = position_dodge(width=0.7), width = .6) +
                geom_errorbar(position = position_dodge(width=0.7), width = 0.15) +
                #facet_wrap(~Target) +
                scale_y_continuous(limits = c(1, 5), oob = scales::squish) +
                theme_bw() + 
                ggtitle("Wisdom") +
                labs(y="Rating of Protagonist's Wisdom", x = "Target of Harm", fill = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                scale_fill_manual(values=met.brewer("Nizami", 2, direction=-1))


```


### Research question 2  

```{r wisd-visuals-rq2, fig.align='center', fig.width=5}
    #getting mean and se for the graph
    descripts <- psych::describeBy(df2$wisdom, 
                                   group = list(df2$anger_express, df2$prot_gender), mat = TRUE) %>% 
                  select(group1, group2, mean, se) %>% 
                  transmute(Expression = group1,
                            Gender = group2,
                            mean, se)
    
    
     #interaction plot - dot-whiskers and lines

    wis_rq2 <-  ggplot(
                descripts,
                aes(x = Gender, color = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Expression), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Wisdom") +
                labs(y="Rating of Protagonist's Wisdom", x = "Protagonist's Gender", color = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5))+ 
                scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))
              
    wis_rq2
              
              #ggsave(plot = wis_rq2, width = 5, height = 5, dpi = 600, filename = "wisdom_rq2.png")              
      #interaction plot - bar plot
              ggplot(
                descripts,
                aes(x = Gender, fill = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) +
                geom_col(position = position_dodge(width=0.7), width = .6) +
                geom_errorbar(position = position_dodge(width=0.7), width = 0.15) +
                #facet_wrap(~Target) +
                scale_y_continuous(limits = c(1, 5), oob = scales::squish) +
                theme_bw() + 
                ggtitle("Wisdom") +
                labs(y="Rating of Protagonist's Wisdom", x = "Protagonist's Gender", fill = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                scale_fill_manual(values=met.brewer("Nizami", 2, direction=-1))    

```


### Research question 3

```{r wisd-visuals-rq3, fig.align='center', fig.width=5}
      #getting mean and se for the graph
      descripts <- psych::describeBy(df2$wisdom, 
                         group = list(df2$anger_express, df2$harm_target, df2$prot_gender), mat = TRUE)   %>% 
                        select(group1, group2, group3, mean, se) %>% 
                        transmute(Expression = group1,
                                  Target = group2,
                                  Gender = group3,
                                  mean, se) %>% 
                        filter(Expression == "Yes")

      
     #interaction plot - dot-whiskers and line plot
  wis_rq3 <- ggplot(
                descripts,
                aes(x = Gender, color = Target, group = Target, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Target), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Wisdom") +
                labs(y="Rating of Protagonist's Wisdom", x = "Protagonist's Gender", color = "Target of Harm") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                      scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))      

    wis_rq3
      #ggsave(plot = wis_rq3, width = 5, height = 5, dpi = 300, filename = "wisdom_rq3.png")
    

```



# Outcome: Obstinacy

## Descriptives

```{r obstin-descript}
#descriptives
    #main effects
    psych::describeBy(df2$obstinacy, group = df2$anger_express, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    psych::describeBy(df2$obstinacy, group = df2$harm_target, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    psych::describeBy(df2$obstinacy, group = df2$prot_gender, mat = TRUE) %>% knitr::kable(digits = 2, format = "pipe")
    
    #interactions
    psych::describeBy(df2$obstinacy, 
                      group = list(df2$anger_express, df2$harm_target), mat = TRUE) %>% 
      knitr::kable(digits = 2, format = "pipe")
    
    psych::describeBy(df2$obstinacy, 
                      group = list(df2$anger_express, df2$prot_gender), mat = TRUE) %>% 
      knitr::kable(digits = 2, format = "pipe")
    
    psych::describeBy(df2$obstinacy, 
                      group = list(df2$anger_express, df2$harm_target, df2$prot_gender), mat = TRUE) %>% 
      knitr::kable(digits = 2, format = "pipe")
    
```

## The models

### Omnibus

```{r obstin-model0}

#omnibus model
    obstinacy_m1 <- lmer(obstinacy ~ harm_target * prot_gender * anger_express + (1 | response_id),
                                 data = df2)
    anova(obstinacy_m1)
    #summary(obstinacy_m1)
    #pander::pander( anova( obstinacy_m1 ) ) 
```


### First research question

```{r obstin-model1}
    emmeans(obstinacy_m1, pairwise ~ anger_express | harm_target)

#additional
    emmeans(obstinacy_m1, pairwise ~ harm_target | anger_express)
```    

### Second research question

```{r obstin-model2}
    emmeans(obstinacy_m1, pairwise ~ prot_gender | anger_express)    
```


### Third research question

```{r obstin-models3}

#interaction
  obstinacy_rq3_model <- df2 %>% 
                            dplyr::filter(anger_express == "Yes") %>% 
                                lmer(obstinacy ~ harm_target * prot_gender + (1 | response_id),
                                                           data = .)
  anova(obstinacy_rq3_model, type = "III") %>% knitr::kable(format = "pipe")

#simple interaction effects
  emmeans(obstinacy_rq3_model, pairwise ~  prot_gender | harm_target)



```

## Figures 

### Research Question 1

```{r obstin-visuals-rq1, fig.align='center', fig.width=5}
#research question 1  
    
    #getting mean and se for the graph
    descripts <- psych::describeBy(df2$obstinacy, 
                                   group = list(df2$anger_express, df2$harm_target), mat = TRUE) %>% 
                  select(group1, group2, mean, se) %>% 
                  transmute(Expression = group1,
                            Target = group2,
                            mean, se)
    
    
     #interaction plot - dot-whiskers and lines
    obst_rq1 <-  ggplot(
                descripts,
                aes(x = Expression, color = Target, group = Target, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Target), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Obstinacy") +
                labs(y="Rating of Protagonist's Obstinacy", x = "Anger Expressed", color = "Target of Harm") +
                theme(plot.title = element_text(hjust = 0.5))+ 
                scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))
              
    obst_rq1
              
              #ggsave(plot = obst_rq1, width = 5, height = 5, dpi = 600, filename = "obstinacy_rq1.png")

      #interaction plot - bar plot
              ggplot(
                descripts,
                aes(x = Target, fill = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) +
                geom_col(position = position_dodge(width=0.7), width = .6) +
                geom_errorbar(position = position_dodge(width=0.7), width = 0.15) +
                #facet_wrap(~Target) +
                scale_y_continuous(limits = c(1, 5), oob = scales::squish) +
                theme_bw() + 
                ggtitle("Obstinacy") +
                labs(y="Rating of Protagonist's Obstinacy", x = "Target of Harm", fill = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                scale_fill_manual(values=met.brewer("Nizami", 2, direction=-1))


```


### Research question 2  

```{r obstin-visuals-rq2, fig.align='center', fig.width=5}
    #getting mean and se for the graph
    descripts <- psych::describeBy(df2$obstinacy, 
                                   group = list(df2$anger_express, df2$prot_gender), mat = TRUE) %>% 
                  select(group1, group2, mean, se) %>% 
                  transmute(Expression = group1,
                            Gender = group2,
                            mean, se)
    
    
     #interaction plot - dot-whiskers and lines

    obst_rq2 <-  ggplot(
                descripts,
                aes(x = Gender, color = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Expression), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Obstinacy") +
                labs(y="Rating of Protagonist's Obstinacy", x = "Protagonist's Gender", color = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5))+ 
                scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))
              
    obst_rq2
              
              #ggsave(plot = obst_rq2, width = 5, height = 5, dpi = 600, filename = "obstinacy_rq2.png")
    
      #interaction plot - bar plot
              ggplot(
                descripts,
                aes(x = Gender, fill = Expression, group = Expression, y = mean,
                    ymin = mean-se, ymax = mean+se)) +
                geom_col(position = position_dodge(width=0.7), width = .6) +
                geom_errorbar(position = position_dodge(width=0.7), width = 0.15) +
                #facet_wrap(~Target) +
                scale_y_continuous(limits = c(1, 5), oob = scales::squish) +
                theme_bw() + 
                ggtitle("Obstinacy") +
                labs(y="Rating of Protagonist's Obstinacy", x = "Protagonist's Gender", fill = "Anger Expressed") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                scale_fill_manual(values=met.brewer("Nizami", 2, direction=-1))    

```


### Research question 3

```{r obstin-visuals-rq3, fig.align='center', fig.width=5}

      #getting mean and se for the graph
      descripts <- psych::describeBy(df2$obstinacy, 
                         group = list(df2$anger_express, df2$harm_target, df2$prot_gender), mat = TRUE)   %>% 
                        select(group1, group2, group3, mean, se) %>% 
                        transmute(Expression = group1,
                                  Target = group2,
                                  Gender = group3,
                                  mean, se) %>% 
                        filter(Expression == "Yes")

      
     #interaction plot - dot-whiskers and line plot
  obst_rq3 <- ggplot(
                descripts,
                aes(x = Gender, color = Target, group = Target, y = mean,
                    ymin = mean-se, ymax = mean+se)) + 
                geom_line(position = position_dodge(0.1)) +
                geom_errorbar(position = position_dodge(0.1), width = 0.12) +
                geom_point(aes(color = Target), position = position_dodge(0.1), size = .8) +
                ylim(1, 5) +
                theme_bw() + 
                ggtitle("Obstinacy") +
                labs(y="Rating of Protagonist's Obstinacy", x = "Protagonist's Gender", color = "Target of Harm") +
                theme(plot.title = element_text(hjust = 0.5), text = element_text(size = 10)) + 
                      scale_color_manual(values=met.brewer("Nizami", 2, direction=-1))      

    obst_rq3
      #ggsave(plot = obst_rq3, width = 5, height = 5, dpi = 300, filename = "obstinacy_rq3.png")
    

```