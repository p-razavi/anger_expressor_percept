---
title: "Dimensionality Analyses of the Character Judgments"
author: "Pooya Razavi"
date: "last knitted: `r Sys.time()`"
output: 
  html_document:
    theme: cosmo
    highlight: textmate
    toc: TRUE
    toc_float: TRUE
editor_options: 
  chunk_output_type: console
---

```{r import-data, include=FALSE}
library(tidyverse)

#read in the datafile
df <- readxl::read_xlsx("Perc_AngExpress_2datasets.xlsx")


#reading in the variable names
var_name_df <- readxl::read_xlsx("variable_names.xlsx")




knitr::opts_chunk$set(echo = TRUE)
```

# Data Preparation

```{r data-cleaning}
#remove rows that are all NAs
df_na_removed <- df %>% 
                    dplyr::filter(!if_all(c(Q20_1, Q70), is.na))

#the original column names (imported from Qualtrics) 
dplyr::glimpse(df[,1:20])


#use the variable names (from the external file) to rename data columns from Qualtrics labels to the character judgments
colnames(df_na_removed) <- var_name_df$var_name


#now the column names are easier to follow
dplyr::glimpse(df[,1:20])

```

Each participant provided multiple ratings. Before combining all the ratings into a long format, we want to mean-center them, because we don't want mean differences between the conditions to artificially influence the factor structure. Below, I'll create a dataframe with mean-centered ratings just for the dimensionality analyses.

```{r mean-centering}

center_scale <- function(x) {
    scale(x, scale = FALSE)
}

ratings_centered <- df_na_removed %>% 
                        select(inf_s_m_y_capable.leader:rud_o_f_y_community.work) %>% 
                        scale(., scale = FALSE) %>% 
                        as_tibble()


#check a couple of columns to show that the mean is indeed zero 
mean(ratings_centered$inf_s_m_y_capable.leader, na.rm = TRUE)
mean(ratings_centered$rud_s_f_n_loyal.truehearted, na.rm = TRUE)
```




```{r long-ish-df}

ratings_centered_longish <- ratings_centered %>% 
                              tibble::rowid_to_column() %>% 
                              tidyr::pivot_longer(data = .,
                                                  cols = !rowid) %>% 
                              separate(name, c("senario", "harm_target", "prot_gender", "anger_express", "col"), 
                                       sep = "_") %>% 
                              tidyr::pivot_wider(data = .,
                                                 names_from = col,
                                                 values_from = value)
                              

#remove the row where all ratings are NA
ratings_centered_longish <- ratings_centered_longish %>% 
                                  dplyr::filter(!if_all(c(capable.leader, community.work), is.na))


```

# Determining the Number of Factors

Determining the optimal number of factors using screeplot, parallel analyses and other methods from the _psych_ package. Different methods suggest that 2-, 4-, and 9-factor structures are plausible solutions.

```{r scree-plot}
#seems like 4- or 5- factors are reasonable solutions
ratings_centered_longish %>% 
  select(capable.leader:community.work) %>% 
  psych::scree()

```



```{r parallel-analysis}
#Parallel analysis suggests that the number of factors =  9  and the number of components =  4 
ratings_centered_longish %>% 
  select(capable.leader:community.work) %>% 
  psych::fa.parallel()


```


```{r velicor-VSS}

#VSS complexity 1 >>>  1  factors
#VSS complexity 2 >>>  2  factors
#The Velicer's MAP >>>  4  factors 
#Empirical BIC >>>  9  factors
#Sample Size adjusted BIC >>>  9  factors

ratings_centered_longish %>% 
  select(capable.leader:community.work) %>% 
  psych::nfactors(n = 9)

```


# Examining Multiple Structural Solutions

The two-component structure is comprised of the positive vs. negative characteristics.

```{r two-components}
        pca_2_component <- ratings_centered_longish %>% 
                              select(capable.leader:community.work) %>% 
                              psych::principal(., nfactors = 2, rotate = "varimax") 
        
        psych::kaiser(pca_2_component, rotate = "Varimax") %>% psych::fa.sort()


```

