---
title: "Dimensionality Analyses of the Character Judgments"
author: "Pooya Razavi"
date: "last knitted: `r Sys.time()`"
output: 
  html_document:
    theme: cosmo
    highlight: textmate
    toc: TRUE
    toc_float: TRUE
editor_options: 
  chunk_output_type: console
---

```{r import-data, include=FALSE}
library(tidyverse)

#read in the datafile
df <- readxl::read_xlsx("Perc_AngExpress_2datasets.xlsx")


#reading in the variable names
var_name_df <- readxl::read_xlsx("variable_names.xlsx")




knitr::opts_chunk$set(echo = TRUE)
```

# Data Preparation

```{r data-cleaning}
#remove rows that are all NAs
df_na_removed <- df %>% 
                    dplyr::filter(!if_all(c(Q20_1, Q70), is.na))

#the original column names (imported from Qualtrics) 
dplyr::glimpse(df[,1:20])


#use the variable names (from the external file) to rename data columns from Qualtrics labels to the character judgments
colnames(df_na_removed) <- var_name_df$var_name


#now the column names are easier to follow
dplyr::glimpse(df[,1:20])

```

Each participant provided multiple ratings. Before combining all the ratings into a long format, we want to mean-center them, because we don't want mean differences between the conditions to artificially influence the factor structure. Below, I'll create a dataframe with mean-centered ratings just for the dimensionality analyses.

```{r mean-centering}

ratings_centered <- df_na_removed %>% 
                        select(inf_s_m_y_capable.leader:rud_o_f_y_community.work) %>% 
                        scale(., scale = FALSE) %>% 
                        as_tibble()


#check a couple of columns to show that the mean is indeed zero 
mean(ratings_centered$inf_s_m_y_capable.leader, na.rm = TRUE)
mean(ratings_centered$rud_s_f_n_loyal.truehearted, na.rm = TRUE)
```




```{r long-ish-df}

ratings_centered_longish <- ratings_centered %>% 
                              tibble::rowid_to_column() %>% 
                              tidyr::pivot_longer(data = .,
                                                  cols = !rowid) %>% 
                              separate(name, c("senario", "harm_target", "prot_gender", "anger_express", "col"), 
                                       sep = "_") %>% 
                              tidyr::pivot_wider(data = .,
                                                 names_from = col,
                                                 values_from = value)
                              

#remove the row where all ratings are NA
ratings_centered_longish <- ratings_centered_longish %>% 
                                  dplyr::filter(!if_all(c(capable.leader, community.work), is.na))


```

# Determining the Number of Factors

Determining the optimal number of factors using screeplot, parallel analyses and other methods from the _psych_ package. Different methods suggest that 2-, 4-, and 9-factor structures are plausible solutions.

```{r scree-plot}
#seems like 4- or 5- factors are reasonable solutions
ratings_centered_longish %>% 
  select(capable.leader:community.work) %>% 
  psych::scree()

```



```{r parallel-analysis}
#Parallel analysis suggests that the number of factors =  9  and the number of components =  4 
ratings_centered_longish %>% 
  select(capable.leader:community.work) %>% 
  psych::fa.parallel()


```


```{r velicor-VSS}

#VSS complexity 1 >>>  1  factors
#VSS complexity 2 >>>  2  factors
#The Velicer's MAP >>>  4  factors 
#Empirical BIC >>>  9  factors
#Sample Size adjusted BIC >>>  9  factors

ratings_centered_longish %>% 
  select(capable.leader:community.work) %>% 
  psych::nfactors(n = 9)

```


# Examining Multiple Structural Solutions

The two-component structure: positive vs. negative characteristics

```{r two-component-str}
pca_2_component <- ratings_centered_longish %>% 
                        select(capable.leader:community.work) %>% 
                        psych::principal(., nfactors = 2, rotate = "varimax") 
        
two_comp_outcome <- psych::kaiser(pca_2_component, rotate = "Varimax") %>% psych::fa.sort()

two_comp_outcome[["loadings"]] %>% 
                  knitr::kable(digits = 2)

```


```{r four-component-str}
pca_4_component <- ratings_centered_longish %>% 
                        select(capable.leader:community.work) %>% 
                        psych::principal(., nfactors = 4, rotate = "varimax") 
        
four_comp_outcome <- psych::kaiser(pca_4_component, rotate = "Varimax") %>% psych::fa.sort()

four_comp_outcome[["loadings"]] %>% 
                  knitr::kable(digits = 2)
```


```{r five-component-str}
pca_5_component <- ratings_centered_longish %>% 
                        select(capable.leader:community.work) %>% 
                        psych::principal(., nfactors = 5, rotate = "varimax") 
        
five_comp_outcome <- psych::kaiser(pca_5_component, rotate = "Varimax") %>% psych::fa.sort()

five_comp_outcome[["loadings"]] %>% 
                  knitr::kable(digits = 2)
```

6-component structure: Worth exploring further...

```{r six-component-str}
pca_6_component <- ratings_centered_longish %>% 
                        select(capable.leader:community.work) %>% 
                        psych::principal(., nfactors = 6, rotate = "varimax") 
        
six_comp_outcome <- psych::kaiser(pca_6_component, rotate = "Varimax") %>% psych::fa.sort()

six_comp_outcome[["loadings"]] %>% 
                  knitr::kable(digits = 2)
```


Not as good as the 8-component structure. Has a couple of components with a single item, and some cross-loading items.

```{r seven-component-str}
pca_7_component <- ratings_centered_longish %>% 
                        select(capable.leader:community.work) %>% 
                        psych::principal(., nfactors = 7, rotate = "varimax") 
        
seven_comp_outcome <- psych::kaiser(pca_7_component, rotate = "Varimax") %>% psych::fa.sort()

seven_comp_outcome[["loadings"]] %>% 
                  knitr::kable(digits = 2)
```



Compared to the 9-component structure, this has considerably fewer issues with cross-loading. And only one component will drop to less than 2 items after removing the cross-loading item. _A good candidate to explore further_

```{r eight-component-str}
pca_8_component <- ratings_centered_longish %>% 
                        select(capable.leader:community.work) %>% 
                        psych::principal(., nfactors = 8, rotate = "varimax") 
        
eight_comp_outcome <- psych::kaiser(pca_8_component, rotate = "Varimax") %>% psych::fa.sort()

eight_comp_outcome[["loadings"]] %>% 
                  knitr::kable(digits = 2)
```

9-component structure has multiple cross-loading items. Removing them will leave some components with less than 2 or 3 items.

```{r nine-component-str}
pca_9_component <- ratings_centered_longish %>% 
                        select(capable.leader:community.work) %>% 
                        psych::principal(., nfactors = 9, rotate = "varimax") 
        
nine_comp_outcome <- psych::kaiser(pca_9_component, rotate = "Varimax") %>% psych::fa.sort()

nine_comp_outcome[["loadings"]] %>% 
                  knitr::kable(digits = 2)
```